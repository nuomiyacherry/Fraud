{"remainingRequest":"D:\\工作项目\\部反诈\\node_modules\\babel-loader\\lib\\index.js!D:\\工作项目\\部反诈\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\工作项目\\部反诈\\src\\utils\\map3d\\core\\three.js","dependencies":[{"path":"D:\\工作项目\\部反诈\\src\\utils\\map3d\\core\\three.js","mtime":1598758375244},{"path":"D:\\工作项目\\部反诈\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\工作项目\\部反诈\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\工作项目\\部反诈\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Object$freeze from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/object/freeze\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\\\u5DE5\\u4F5C\\u9879\\u76EE\\\\\\u90E8\\u53CD\\u8BC8\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/inherits\";\nimport * as THREE from 'three';\nimport { addControls, addGui, addTween, addStats } from './util';\nimport EventEmitter from '../libs/event-emitter';\nimport { requestAnimationFrame, on, off, setStyles } from '../libs/dom';\nimport merge from 'lodash/merge';\n\nvar Three =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Three, _EventEmitter);\n\n  function Three(el, options) {\n    var _this;\n\n    _classCallCheck(this, Three);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Three).call(this));\n    _this.el = el;\n    setStyles(el, {\n      width: '100%',\n      height: '100%',\n      position: 'relative'\n    });\n\n    _this.createCanvasContainer();\n\n    var aspect = 2,\n        defaultOpt = {\n      stats: false,\n      gui: false,\n      tween: true,\n      controls: false,\n      background: '#000000',\n      opcity: 1,\n      autoResize: true,\n      rendererOptions: {\n        // 开启抗锯齿,使线条平滑\n        antialias: true,\n        // 在背景色透明显示渐变色\n        alpha: true\n      },\n      ftp: 60,\n      // createCamera为 OrthographicCamera时aspect必传，window.resize是需要用到\n      aspect: aspect\n    };\n    _this.options = merge({}, defaultOpt, options);\n    _this.f = Math.round(60 / _this.options.ftp);\n    _this.skip = 0; // 存储鼠标事件方法\n\n    _this.Events = []; // this.necessaryInit()\n\n    return _this;\n  }\n\n  _createClass(Three, [{\n    key: \"createCanvasContainer\",\n    value: function createCanvasContainer() {\n      this.container = document.createElement('div');\n      setStyles(this.container, {\n        position: 'absolute',\n        overflow: 'hidden',\n        width: '100%',\n        height: '100%',\n        padding: '0px',\n        margin: '0px',\n        borderWidth: '0px',\n        top: 0,\n        left: 0\n      });\n      this.el.appendChild(this.container);\n    }\n  }, {\n    key: \"necessaryInit\",\n    value: function () {\n      var _necessaryInit = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this$options, stats, gui, tween, controls, autoResize;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$options = this.options, stats = _this$options.stats, gui = _this$options.gui, tween = _this$options.tween, controls = _this$options.controls, autoResize = _this$options.autoResize;\n                this.setSize();\n                this.gui && this.gui.destroy();\n                this.scene = new THREE.Scene();\n                this.setRenderer();\n                this.setCamera(); // this.scene.background = new THREE.Color(0xff0000)\n\n                this.scene.add(this.camera);\n\n                if (!(process.env.NODE_ENV === 'development')) {\n                  _context.next = 14;\n                  break;\n                }\n\n                if (!stats) {\n                  _context.next = 11;\n                  break;\n                }\n\n                _context.next = 11;\n                return addStats(this);\n\n              case 11:\n                if (!gui) {\n                  _context.next = 14;\n                  break;\n                }\n\n                _context.next = 14;\n                return addGui(this);\n\n              case 14:\n                if (!tween) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.next = 17;\n                return addTween(this);\n\n              case 17:\n                if (!controls) {\n                  _context.next = 20;\n                  break;\n                }\n\n                _context.next = 20;\n                return addControls(this);\n\n              case 20:\n                autoResize && on(window, 'resize', this._resize.bind(this));\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function necessaryInit() {\n        return _necessaryInit.apply(this, arguments);\n      }\n\n      return necessaryInit;\n    }() // on(eventType, callback) {\n    //   this.eventEmitter.off(eventType, callback)\n    // }\n    // off(eventType, callback) {\n    //   this.eventEmitter.off(eventType, callback)\n    // }\n    // emit(eventType, ...args) {\n    //   this.eventEmitter.emit()\n    // }\n    // once()\n    // 子类覆盖\n\n  }, {\n    key: \"render\",\n    value: function render() {} // 子类覆盖\n\n  }, {\n    key: \"setCamera\",\n    value: function setCamera() {} // 注册鼠标事件\n\n  }, {\n    key: \"registerMouseEvent\",\n    value: function registerMouseEvent(eventType, callback, meshes) {\n      var _this2 = this;\n\n      // const canvas = this.renderer.domElement,\n      var fn = function fn(e) {\n        e.intersects = _this2.getIntersects(e, meshes);\n        callback && callback.call(_this2, e);\n      };\n\n      on(this.container, eventType, fn);\n      this.Events.push({\n        eventType: eventType,\n        callback: fn\n      });\n    }\n    /**\n     * 获取鼠标事件产生的 THREE.Object3D对象\n     * 使用e.offsetX而不使用e.clientX是父元素相对屏幕的位置会有偏移，用clientX会导致Mesh定位不准\n     * @param {鼠标事件对象} e\n     * @return [Array] THREE.Object3D对象组成的数组\n     */\n\n  }, {\n    key: \"getIntersects\",\n    value: function getIntersects(e, meshes) {\n      var width = e.target.width,\n          height = e.target.clientHeight;\n      !this.raycaster && (this.raycaster = new THREE.Raycaster());\n      !this.mouseVector && (this.mouseVector = new THREE.Vector2());\n      this.mouseVector.x = e.offsetX / width * 2 - 1;\n      this.mouseVector.y = -(e.offsetY / height) * 2 + 1;\n      this.raycaster.setFromCamera(this.mouseVector, this.camera);\n      return this.raycaster.intersectObjects(meshes || this.scene.children, true);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(object) {\n      if (object instanceof THREE.Group) {\n        this.removeGroup(object);\n      } else {\n        this.removeObject(object);\n      }\n    } // 删除THREE.Group对象\n    // group THREE.Group 对象或者 group名称\n\n  }, {\n    key: \"removeGroup\",\n    value: function removeGroup(group) {\n      var _this3 = this;\n\n      group = group instanceof THREE.Group ? group : this.scene.getObjectByName(group);\n\n      if (!group) {\n        return;\n      }\n\n      group.children.forEach(function (item) {\n        // console.log(item)\n        if (item instanceof THREE.Group) {\n          _this3.removeGroup(item);\n        } else {\n          _this3.removeObject(item);\n        }\n      });\n      this.scene.remove(group);\n    }\n  }, {\n    key: \"removeObject\",\n    value: function removeObject(object) {\n      if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Points || object instanceof THREE.LineLoop || object instanceof THREE.LineSegments) {\n        object.geometry && object.geometry.dispose && object.geometry.dispose();\n        object.material && object.material.dispose && object.material.dispose();\n        this.scene.remove(object);\n      }\n    }\n  }, {\n    key: \"removeEvents\",\n    value: function removeEvents() {\n      var _this4 = this;\n\n      this.Events.forEach(function (_ref) {\n        var eventType = _ref.eventType,\n            callback = _ref.callback;\n        off(_this4.renderer.domElement, eventType, callback);\n      });\n      this.Events = [];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var _this5 = this;\n\n      this.scene && this.scene.children.forEach(function (group) {\n        _this5.remove(group);\n      });\n      this.removeEvents();\n    } // 清除WebGL上下文\n\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      if (!this.renderer) {\n        return;\n      }\n\n      this.destroyHook && this.destroyHook();\n      var el = this.renderer.domElement.parentNode;\n      this.scene.remove(this.camera);\n      this.clear();\n      this.camera = null;\n      this.scene = null;\n      this.renderer.forceContextLoss();\n      el.removeChild(this.renderer.domElement);\n      this.renderer.context = null;\n      this.renderer.domElement = null;\n      this.renderer = null;\n\n      if (this.stats) {\n        el.removeChild(this.stats.dom);\n        this.stats = null;\n      }\n\n      el.innerHTML = '';\n      this.gui && this.gui.destroy();\n      this._resize && off(window, 'resize', this._resize.bind(this));\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize() {\n      this.rendererSize = _Object$freeze({\n        width: this.container.clientWidth,\n        height: this.container.clientHeight\n      });\n    }\n  }, {\n    key: \"setRenderer\",\n    value: function setRenderer() {\n      var _this$rendererSize = this.rendererSize,\n          width = _this$rendererSize.width,\n          height = _this$rendererSize.height,\n          _this$options2 = this.options,\n          rendererOptions = _this$options2.rendererOptions,\n          background = _this$options2.background,\n          opacity = _this$options2.opacity;\n      this.renderer = new THREE.WebGLRenderer(rendererOptions);\n      this.renderer.shadowMapSoft = true;\n      this.renderer.shadowMap.enabled = true;\n      this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n      this.renderer.setSize(width, height);\n      this.renderer.setPixelRatio(window.devicePixelRatio);\n      this.renderer.setClearColor(background, opacity); // setStyles(this.renderer.domElement, {\n      //   position: 'absolute',\n      //   zIndex: 10,\n      //   left: 0,\n      //   top: 0\n      // })\n\n      this.container.appendChild(this.renderer.domElement); // this.renderer = renderer 这里不能这么写，渲染会有问题\n    }\n  }, {\n    key: \"_render\",\n    value: function _render() {\n      if (!this.renderer) {\n        return;\n      } // 根据otpions中的 ftp 做跳帧处理，优化\n\n\n      if (this.skip !== 0 || this.f === 1) {\n        this.options.render && this.options.render();\n        this.render && this.render();\n        this.stats && this.stats.update();\n        this.controls && this.controls.update();\n        this.renderer.render(this.scene, this.camera);\n        this.skip = ++this.skip % this.f;\n      } else {\n        this.skip = ++this.skip % this.f;\n      }\n\n      requestAnimationFrame(this._render.bind(this));\n    }\n  }, {\n    key: \"_resize\",\n    value: function _resize() {\n      if (!this || !this.renderer) {\n        return;\n      }\n\n      this.setSize();\n      this.resize && this.resize();\n      var _this$rendererSize2 = this.rendererSize,\n          width = _this$rendererSize2.width,\n          height = _this$rendererSize2.height;\n\n      if (this.camera instanceof THREE.PerspectiveCamera) {\n        this.camera.aspect = width / height;\n      } else {\n        var aspect = this.options.aspect;\n        this.camera.left = -width / aspect;\n        this.camera.right = width / aspect;\n        this.camera.top = height / aspect;\n        this.camera.bottom = -height / aspect;\n      }\n\n      this.camera.updateProjectionMatrix();\n      this.renderer.setSize(width, height);\n    }\n  }]);\n\n  return Three;\n}(EventEmitter);\n\nexport { Three as default };",{"version":3,"sources":["D:\\工作项目\\部反诈\\src\\utils\\map3d\\core\\three.js"],"names":["THREE","addControls","addGui","addTween","addStats","EventEmitter","requestAnimationFrame","on","off","setStyles","merge","Three","el","options","width","height","position","createCanvasContainer","aspect","defaultOpt","stats","gui","tween","controls","background","opcity","autoResize","rendererOptions","antialias","alpha","ftp","f","Math","round","skip","Events","container","document","createElement","overflow","padding","margin","borderWidth","top","left","appendChild","setSize","destroy","scene","Scene","setRenderer","setCamera","add","camera","process","env","NODE_ENV","window","_resize","bind","eventType","callback","meshes","fn","e","intersects","getIntersects","call","push","target","clientHeight","raycaster","Raycaster","mouseVector","Vector2","x","offsetX","y","offsetY","setFromCamera","intersectObjects","children","object","Group","removeGroup","removeObject","group","getObjectByName","forEach","item","remove","Mesh","Line","Points","LineLoop","LineSegments","geometry","dispose","material","renderer","domElement","removeEvents","destroyHook","parentNode","clear","forceContextLoss","removeChild","context","dom","innerHTML","rendererSize","clientWidth","opacity","WebGLRenderer","shadowMapSoft","shadowMap","enabled","type","PCFSoftShadowMap","setPixelRatio","devicePixelRatio","setClearColor","render","update","_render","resize","PerspectiveCamera","right","bottom","updateProjectionMatrix"],"mappings":"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","sourcesContent":["import * as THREE from 'three'\nimport { addControls, addGui, addTween, addStats } from './util'\nimport EventEmitter from '../libs/event-emitter'\nimport { requestAnimationFrame, on, off, setStyles } from '../libs/dom'\nimport merge from 'lodash/merge'\n\nexport default class Three extends EventEmitter {\n  constructor(el, options) {\n    super()\n    this.el = el\n    setStyles(el, {\n      width: '100%',\n      height: '100%',\n      position: 'relative'\n    })\n    this.createCanvasContainer()\n    const aspect = 2,\n      defaultOpt = {\n        stats: false,\n        gui: false,\n        tween: true,\n        controls: false,\n        background: '#000000',\n        opcity: 1,\n        autoResize: true,\n        rendererOptions: {\n          // 开启抗锯齿,使线条平滑\n          antialias: true,\n          // 在背景色透明显示渐变色\n          alpha: true\n        },\n        ftp: 60,\n        // createCamera为 OrthographicCamera时aspect必传，window.resize是需要用到\n        aspect\n      }\n    this.options = merge({}, defaultOpt, options)\n\n    this.f = Math.round(60 / this.options.ftp)\n    this.skip = 0\n    // 存储鼠标事件方法\n    this.Events = []\n    // this.necessaryInit()\n  }\n\n  createCanvasContainer() {\n    this.container = document.createElement('div')\n    setStyles(this.container, {\n      position: 'absolute',\n      overflow: 'hidden',\n      width: '100%',\n      height: '100%',\n      padding: '0px',\n      margin: '0px',\n      borderWidth: '0px',\n      top: 0,\n      left: 0\n    })\n    this.el.appendChild(this.container)\n  }\n\n  async necessaryInit() {\n    const { stats, gui, tween, controls, autoResize } = this.options\n    this.setSize()\n    this.gui && this.gui.destroy()\n    this.scene = new THREE.Scene()\n    this.setRenderer()\n    this.setCamera()\n    // this.scene.background = new THREE.Color(0xff0000)\n    this.scene.add(this.camera)\n\n    if (process.env.NODE_ENV === 'development') {\n      if (stats) {\n        await addStats(this)\n      }\n      if (gui) {\n        await addGui(this)\n      }\n    }\n    if (tween) {\n      await addTween(this)\n    }\n    if (controls) {\n      await addControls(this)\n    }\n    autoResize && on(window, 'resize', this._resize.bind(this))\n  }\n\n  // on(eventType, callback) {\n  //   this.eventEmitter.off(eventType, callback)\n  // }\n\n  // off(eventType, callback) {\n  //   this.eventEmitter.off(eventType, callback)\n  // }\n\n  // emit(eventType, ...args) {\n  //   this.eventEmitter.emit()\n  // }\n\n  // once()\n\n  // 子类覆盖\n  render() {}\n\n  // 子类覆盖\n  setCamera() {}\n\n  // 注册鼠标事件\n  registerMouseEvent(eventType, callback, meshes) {\n    // const canvas = this.renderer.domElement,\n    const fn = e => {\n      e.intersects = this.getIntersects(e, meshes)\n      callback && callback.call(this, e)\n    }\n    on(this.container, eventType, fn)\n    this.Events.push({ eventType, callback: fn })\n  }\n\n  /**\n   * 获取鼠标事件产生的 THREE.Object3D对象\n   * 使用e.offsetX而不使用e.clientX是父元素相对屏幕的位置会有偏移，用clientX会导致Mesh定位不准\n   * @param {鼠标事件对象} e\n   * @return [Array] THREE.Object3D对象组成的数组\n   */\n  getIntersects(e, meshes) {\n    const width = e.target.width,\n      height = e.target.clientHeight\n    !this.raycaster && (this.raycaster = new THREE.Raycaster())\n    !this.mouseVector && (this.mouseVector = new THREE.Vector2())\n    this.mouseVector.x = (e.offsetX / width) * 2 - 1\n    this.mouseVector.y = -(e.offsetY / height) * 2 + 1\n    this.raycaster.setFromCamera(this.mouseVector, this.camera)\n    return this.raycaster.intersectObjects(meshes || this.scene.children, true)\n  }\n\n  remove(object) {\n    if (object instanceof THREE.Group) {\n      this.removeGroup(object)\n    } else {\n      this.removeObject(object)\n    }\n  }\n\n  // 删除THREE.Group对象\n  // group THREE.Group 对象或者 group名称\n  removeGroup(group) {\n    group =\n      group instanceof THREE.Group ? group : this.scene.getObjectByName(group)\n    if (!group) {\n      return\n    }\n    group.children.forEach(item => {\n      // console.log(item)\n      if (item instanceof THREE.Group) {\n        this.removeGroup(item)\n      } else {\n        this.removeObject(item)\n      }\n    })\n    this.scene.remove(group)\n  }\n\n  removeObject(object) {\n    if (\n      object instanceof THREE.Mesh ||\n      object instanceof THREE.Line ||\n      object instanceof THREE.Points ||\n      object instanceof THREE.LineLoop ||\n      object instanceof THREE.LineSegments\n    ) {\n      object.geometry && object.geometry.dispose && object.geometry.dispose()\n      object.material && object.material.dispose && object.material.dispose()\n      this.scene.remove(object)\n    }\n  }\n\n  removeEvents() {\n    this.Events.forEach(({ eventType, callback }) => {\n      off(this.renderer.domElement, eventType, callback)\n    })\n\n    this.Events = []\n  }\n\n  clear() {\n    this.scene &&\n      this.scene.children.forEach(group => {\n        this.remove(group)\n      })\n    this.removeEvents()\n  }\n  // 清除WebGL上下文\n  destroy() {\n    if (!this.renderer) {\n      return\n    }\n    this.destroyHook && this.destroyHook()\n    const el = this.renderer.domElement.parentNode\n    this.scene.remove(this.camera)\n    this.clear()\n    this.camera = null\n    this.scene = null\n    this.renderer.forceContextLoss()\n    el.removeChild(this.renderer.domElement)\n    this.renderer.context = null\n    this.renderer.domElement = null\n    this.renderer = null\n    if (this.stats) {\n      el.removeChild(this.stats.dom)\n      this.stats = null\n    }\n    el.innerHTML = ''\n    this.gui && this.gui.destroy()\n    this._resize && off(window, 'resize', this._resize.bind(this))\n  }\n\n  setSize() {\n    this.rendererSize = Object.freeze({\n      width: this.container.clientWidth,\n      height: this.container.clientHeight\n    })\n  }\n\n  setRenderer() {\n    const { width, height } = this.rendererSize,\n      { rendererOptions, background, opacity } = this.options\n    this.renderer = new THREE.WebGLRenderer(rendererOptions)\n    this.renderer.shadowMapSoft = true\n    this.renderer.shadowMap.enabled = true\n    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap\n    this.renderer.setSize(width, height)\n    this.renderer.setPixelRatio(window.devicePixelRatio)\n    this.renderer.setClearColor(background, opacity)\n    // setStyles(this.renderer.domElement, {\n    //   position: 'absolute',\n    //   zIndex: 10,\n    //   left: 0,\n    //   top: 0\n    // })\n    this.container.appendChild(this.renderer.domElement)\n    // this.renderer = renderer 这里不能这么写，渲染会有问题\n  }\n\n  _render() {\n    if (!this.renderer) {\n      return\n    }\n    // 根据otpions中的 ftp 做跳帧处理，优化\n    if (this.skip !== 0 || this.f === 1) {\n      this.options.render && this.options.render()\n      this.render && this.render()\n      this.stats && this.stats.update()\n      this.controls && this.controls.update()\n      this.renderer.render(this.scene, this.camera)\n\n      this.skip = ++this.skip % this.f\n    } else {\n      this.skip = ++this.skip % this.f\n    }\n    requestAnimationFrame(this._render.bind(this))\n  }\n\n  _resize() {\n    if (!this || !this.renderer) {\n      return\n    }\n    this.setSize()\n    this.resize && this.resize()\n    const { width, height } = this.rendererSize\n    if (this.camera instanceof THREE.PerspectiveCamera) {\n      this.camera.aspect = width / height\n    } else {\n      const aspect = this.options.aspect\n      this.camera.left = -width / aspect\n      this.camera.right = width / aspect\n      this.camera.top = height / aspect\n      this.camera.bottom = -height / aspect\n    }\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(width, height)\n  }\n}\n"]}]}